import{createClient as L}from"https://esm.sh/@supabase/supabase-js@2.39.5";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const O="modulepreload",S=function(s){return"/"+s},I={},B=function(c,i,r){let e=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));e=Promise.allSettled(i.map(l=>{if(l=S(l),l in I)return;I[l]=!0;const d=l.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const a=document.createElement("link");if(a.rel=d?"stylesheet":O,d||(a.as="script"),a.crossOrigin="",a.href=l,o&&a.setAttribute("nonce",o),document.head.appendChild(a),d)return new Promise((p,u)=>{a.addEventListener("load",p),a.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${l}`)))})}))}function t(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return e.then(n=>{for(const o of n||[])o.status==="rejected"&&t(o.reason);return c().catch(t)})};window.hasRunImageLoader?console.log("‚è© imageLoader wurde bereits geladen ‚Äì Abbruch."):(window.hasRunImageLoader=!0,B(async()=>{const{createClient:s}=await import("https://esm.sh/@supabase/supabase-js@2.39.5");return{createClient:s}},[]).then(({createClient:s})=>{const c=s("https://ilgwunzkstvsdnzugawo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsZ3d1bnprc3R2c2RuenVnYXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM0NjUyOTQsImV4cCI6MjA1OTA0MTI5NH0.l932PSd2eAkBVe-WjsdZDKieCL-c8dnlpOGZb7HwHP4");document.addEventListener("DOMContentLoaded",async()=>{const i=window.location.pathname.split("/buy/")[1];if(!i)return console.warn("‚ö†Ô∏è Kein Slug gefunden");console.log("üì¶ Slug:",i);const{data:r,error:e}=await c.from("file_metadata").select("id, title, description, price, preview_url, slug").eq("slug",i).maybeSingle();if(console.log("üîç Supabase Response:",{data:r,error:e}),e||!r){document.body.innerHTML="<h1>‚ùå Datei nicht gefunden</h1>";return}document.body.innerHTML=`
        <h1>${r.title||"üì∑ Unbenanntes Bild"}</h1>
        <p>${r.description||"Keine Beschreibung vorhanden"}</p>
        <p><strong>Preis:</strong> ‚Ç¨${parseFloat(r.price).toFixed(2)}</p>
        <img src="${r.preview_url}" style="max-width:100%;filter:blur(15px);border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.2);">
        <br><br>
        <input type="email" id="email" placeholder="Deine E-Mail">
        <button id="pay">üí≥ Jetzt bezahlen</button>
        <button id="report" style="margin-left: 10px;">üö® Melden</button>
      `,document.getElementById("pay").addEventListener("click",async()=>{const t=document.getElementById("email").value;if(!t)return alert("Bitte gib deine E-Mail ein");const o=await(await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Math.round(parseFloat(r.price)*100),email:t,fileId:r.id})})).json();o.url?window.location.href=o.url:alert("Fehler bei Stripe-Weiterleitung")}),document.getElementById("report").addEventListener("click",()=>{window.location.href=`/index.html#report?link=https://letunblur.com/buy/${i}`})})}));const h=L("https://ilgwunzkstvsdnzugawo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsZ3d1bnprc3R2c2RuenVnYXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM0NjUyOTQsImV4cCI6MjA1OTA0MTI5NH0.l932PSd2eAkBVe-WjsdZDKieCL-c8dnlpOGZb7HwHP4"),P="https://letunblur-backend.onrender.com";let w="",C="";async function J(){var o,l,d,m,a,p;const s=(l=(o=document.getElementById("fileInput"))==null?void 0:o.files)==null?void 0:l[0],c=(d=document.getElementById("email"))==null?void 0:d.value,i=(m=document.getElementById("price"))==null?void 0:m.value;if(!s||!c||!i){alert("Bitte Datei, E-Mail und Preis angeben.");return}const r=await h.auth.getUser(),e=(p=(a=r==null?void 0:r.data)==null?void 0:a.user)==null?void 0:p.id;if(!e){alert("Du musst eingeloggt sein, um hochzuladen.");return}const t=`${Date.now()}-${s.name}`,n=`media_uploads/${e}/${t}`;try{const{error:u}=await h.storage.from("media_uploads").upload(n,s);if(u)throw u;const{publicURL:v,error:g}=h.storage.from("media_uploads").getPublicUrl(n);if(g)throw g;w=v,C=t;const f=await(await fetch(`${P}/api/upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,file_name:t,price:i,title:s.name,description:"Hochgeladen von User"})})).json();if(!f.success)throw new Error("Fehler beim Speichern der Metadaten.");const y=document.getElementById("previewImage"),b=document.getElementById("preview");y&&b&&(y.src=w,b.style.display="block"),document.getElementById("output").innerHTML=`
      ‚úÖ Upload erfolgreich!<br>
      üîó <a href="${f.link}" target="_blank">${f.link}</a>
    `}catch(u){console.error(u),document.getElementById("output").innerText=`‚ùå Fehler beim Upload: ${u.message}`}}var E;(E=document.getElementById("uploadButton"))==null||E.addEventListener("click",J);
